<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Villa Zaragoza - Official ID Maker</title>

<!-- Professional Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Montserrat', sans-serif;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    color: #333;
    line-height: 1.6;
    min-height: 100vh;
    overflow-x: hidden;
}

/* Header */
.header {
    background: linear-gradient(to right, #0d3b66 0%, #1a5a8a 100%);
    color: white;
    padding: 1.5rem 2rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    position: relative;
    overflow: hidden;
}

.header::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="none"/><path d="M20,20 L80,20 L80,80 L20,80 Z" stroke="rgba(255,255,255,0.05)" stroke-width="2" fill="none"/></svg>');
    opacity: 0.3;
}

.header-content {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: 15px;
    position: relative;
    z-index: 2;
}

.logo {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 10px;
}

.logo-icon {
    font-size: 2.5rem;
    color: #f4a261;
}

.logo-text h1 {
    font-family: 'Playfair Display', serif;
    font-size: 1.8rem;
    font-weight: 600;
    letter-spacing: 0.5px;
}

.logo-text p {
    font-size: 0.9rem;
    opacity: 0.9;
    margin-top: 2px;
}

.tagline {
    font-style: italic;
    font-weight: 500;
    opacity: 0.9;
    font-size: 1rem;
    max-width: 600px;
}

/* Main container */
.main-container {
    max-width: 1400px;
    margin: 2rem auto;
    padding: 0 1.5rem;
}

.page-title {
    font-family: 'Playfair Display', serif;
    color: #0d3b66;
    font-size: 2.2rem;
    margin-bottom: 1.5rem;
    text-align: center;
    position: relative;
    padding-bottom: 10px;
}

.page-title::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 120px;
    height: 3px;
    background: linear-gradient(to right, #0d3b66, #f4a261);
    border-radius: 2px;
}

/* TWO-COLUMN LAYOUT - FORM ON LEFT, FULL-SIZE PREVIEW ON RIGHT */
.container {
    display: grid;
    grid-template-columns: 400px 1fr;
    gap: 40px;
    margin-top: 2rem;
}

/* Form Panel */
.form-panel {
    background: white;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
    border: 1px solid #e0e0e0;
    position: relative;
    overflow: hidden;
    height: fit-content;
    position: sticky;
    top: 30px;
}

.form-panel::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 5px;
    background: linear-gradient(to right, #0d3b66, #f4a261);
}

.panel-header {
    margin-bottom: 25px;
    display: flex;
    align-items: center;
    gap: 12px;
}

.panel-icon {
    font-size: 1.8rem;
    color: #0d3b66;
}

.panel-header h2 {
    font-size: 1.5rem;
    color: #0d3b66;
    font-weight: 700;
}

.form-group {
    margin-bottom: 20px;
    position: relative;
}

.form-label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #444;
    font-size: 0.95rem;
}

.form-label .required {
    color: #e74c3c;
    margin-left: 3px;
}

.form-input {
    width: 100%;
    padding: 14px 15px;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-family: 'Montserrat', sans-serif;
    font-size: 15px;
    transition: all 0.3s;
    background-color: #fafafa;
}

.form-input:focus {
    outline: none;
    border-color: #0d3b66;
    box-shadow: 0 0 0 3px rgba(13, 59, 102, 0.1);
    background-color: white;
}

.form-input.error {
    border-color: #e74c3c;
    background-color: #fff5f5;
}

.form-input.valid {
    border-color: #2ecc71;
    background-color: #f8fff9;
}

.error-message {
    color: #e74c3c;
    font-size: 0.85rem;
    margin-top: 5px;
    display: none;
}

/* Photo upload specific */
.photo-upload-container {
    position: relative;
}

.photo-preview {
    width: 100%;
    height: 200px;
    border: 2px dashed #ddd;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 10px;
    overflow: hidden;
    background: #f9f9f9;
}

.photo-preview img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
}

.photo-placeholder {
    text-align: center;
    color: #777;
}

.photo-placeholder i {
    font-size: 3rem;
    color: #bbb;
    margin-bottom: 10px;
}

/* Switch */
.switch-wrapper {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 25px;
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #e9ecef;
}

.switch-label {
    font-weight: 600;
    color: #0d3b66;
    font-size: 0.95rem;
}

.switch {
    position: relative;
    width: 60px;
    height: 30px;
}

.switch input { 
    display: none;
}

.slider {
    position: absolute;
    cursor: pointer;
    inset: 0;
    background: #ccc;
    border-radius: 30px;
    transition: 0.3s;
}

.slider:before {
    content: "";
    position: absolute;
    height: 24px;
    width: 24px;
    left: 3px;
    bottom: 3px;
    background: white;
    border-radius: 50%;
    transition: 0.3s;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

input:checked + .slider {
    background: linear-gradient(to right, #0d3b66, #1a5a8a);
}

input:checked + .slider:before {
    transform: translateX(30px);
}

/* Buttons */
.button-group {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 25px;
}

.btn {
    padding: 16px;
    border: none;
    border-radius: 8px;
    font-family: 'Montserrat', sans-serif;
    font-weight: 600;
    font-size: 15px;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.btn-primary {
    background: linear-gradient(to right, #0d3b66, #1a5a8a);
    color: white;
}

.btn-primary:hover:not(:disabled) {
    background: linear-gradient(to right, #1a5a8a, #0d3b66);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(13, 59, 102, 0.2);
}

.btn-primary:disabled {
    background: #cccccc;
    cursor: not-allowed;
    opacity: 0.7;
}

.btn-secondary {
    background: #f8f9fa;
    color: #333;
    border: 1px solid #ddd;
}

.btn-secondary:hover:not(:disabled) {
    background: #e9ecef;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
}

.btn-secondary:disabled {
    background: #f0f0f0;
    cursor: not-allowed;
    opacity: 0.7;
    color: #999;
}

.btn-success {
    background: linear-gradient(to right, #2a9d8f, #34a0a4);
    color: white;
}

.btn-success:hover:not(:disabled) {
    background: linear-gradient(to right, #21867a, #2a9d8f);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(42, 157, 143, 0.2);
}

.btn-success:disabled {
    background: #cccccc;
    cursor: not-allowed;
    opacity: 0.7;
}

.btn-warning {
    background: linear-gradient(to right, #f4a261, #e76f51);
    color: white;
}

.btn-warning:hover:not(:disabled) {
    background: linear-gradient(to right, #e76f51, #f4a261);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(231, 111, 81, 0.2);
}

.btn-warning:disabled {
    background: #cccccc;
    cursor: not-allowed;
    opacity: 0.7;
}

/* Preview Panel - Takes full remaining width */
.preview-panel {
    display: flex;
    flex-direction: column;
    width: 100%;
}

.preview-header {
    width: 100%;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    gap: 15px;
}

.preview-title {
    font-size: 1.3rem;
    color: #0d3b66;
    font-weight: 700;
}

.preview-actions {
    display: flex;
    gap: 10px;
    align-items: center;
}

.preview-note {
    font-size: 0.9rem;
    color: #666;
    background: #f8f9fa;
    padding: 12px 15px;
    border-radius: 8px;
    margin-bottom: 25px;
    width: 100%;
    text-align: center;
    border-left: 4px solid #f4a261;
}

/* Validation status indicator */
.validation-status {
    padding: 10px 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    font-weight: 600;
    text-align: center;
    display: none;
}

.validation-status.error {
    background-color: #ffeaea;
    color: #e74c3c;
    border-left: 4px solid #e74c3c;
}

.validation-status.success {
    background-color: #eaffea;
    color: #2ecc71;
    border-left: 4px solid #2ecc71;
}

/* ID Card Container - NO SCALING, FULL SIZE */
.id-card-container {
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    background: white;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
    border: 1px solid #e0e0e0;
    overflow: visible;
    min-height: 700px;
}

/* ID Card - ORIGINAL SIZE, NO SCALING */
#id-card {
    width: 1012px;
    height: 638px;
    background: url("./Landscape.png") center/cover no-repeat;
    position: relative;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    border-radius: 8px;
    overflow: hidden;
    border: 1px solid rgba(0, 0, 0, 0.1);
    /* NO SCALING - ORIGINAL SIZE */
}

#id-card.portrait {
    width: 638px;
    height: 1012px;
    background: url("./Portrait.png") center/cover no-repeat;
}

/* Photo */
#photo-box {
    position: absolute;
    top: 210px;
    left: 80px;
    width: 240px;
    height: 240px;
    overflow: hidden;
    border-radius: 4px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

#photo-box img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* ID TEXT STYLE */
.text {
    position: absolute;
    font-family: 'Montserrat', Arial, sans-serif;
    font-size: 20px;
    color: #2b2b2b;
    font-weight: 700;
    letter-spacing: 1.2px;
    text-transform: uppercase;
}

/* LANDSCAPE TEXT */
#name { top: 250px; left: 485px; }
#address { top: 335px; left: 485px; width: 480px; }
#contact { top: 425px; left: 485px; }

/* PORTRAIT PHOTO */
#id-card.portrait #photo-box {
    top: 270px;
    left: 200px;
}

/* PORTRAIT TEXT – CENTERED */
#id-card.portrait #name,
#id-card.portrait #address,
#id-card.portrait #contact {
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
    width: 520px;
}
#id-card.portrait #name { top: 635px; }
#id-card.portrait #address { top: 715px; }
#id-card.portrait #contact { top: 790px; }

/* Footer */
.footer {
    background: #0d3b66;
    color: white;
    padding: 2rem;
    margin-top: 3rem;
    text-align: center;
}

.footer-content {
    max-width: 1200px;
    margin: 0 auto;
}

.footer p {
    margin-bottom: 10px;
    opacity: 0.9;
}

.footer-links {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 25px;
    margin-top: 15px;
}

.footer-links a {
    color: white;
    text-decoration: none;
    opacity: 0.8;
    transition: opacity 0.3s;
}

.footer-links a:hover {
    opacity: 1;
    text-decoration: underline;
}

/* ========= RESPONSIVE DESIGN ========= */
@media (max-width: 1500px) {
    .main-container {
        max-width: 95%;
    }
    
    /* Adjust grid for medium screens */
    .container {
        grid-template-columns: 380px 1fr;
        gap: 30px;
    }
}

@media (max-width: 1200px) {
    /* Switch to vertical layout on tablets */
    .container {
        grid-template-columns: 1fr;
        gap: 30px;
    }
    
    .form-panel {
        position: static;
        max-width: 600px;
        margin: 0 auto;
    }
    
    /* Scale ID card to fit tablet screens */
    #id-card {
        transform: scale(0.9);
        transform-origin: center top;
    }
    
    #id-card.portrait {
        transform: scale(0.9);
        transform-origin: center top;
    }
}

@media (max-width: 992px) {
    /* Scale down further on smaller tablets */
    #id-card {
        transform: scale(0.8);
    }
    
    #id-card.portrait {
        transform: scale(0.8);
    }
}

@media (max-width: 768px) {
    .header {
        padding: 1rem;
    }
    
    .logo {
        flex-direction: column;
        text-align: center;
        gap: 10px;
    }
    
    .logo-text h1 {
        font-size: 1.5rem;
    }
    
    .page-title {
        font-size: 1.8rem;
    }
    
    .main-container {
        padding: 0 1rem;
    }
    
    .form-panel {
        padding: 20px;
    }
    
    .id-card-container {
        padding: 20px;
    }
    
    /* Scale ID card for mobile */
    #id-card {
        transform: scale(0.65);
    }
    
    #id-card.portrait {
        transform: scale(0.65);
    }
    
    .preview-header {
        flex-direction: column;
        text-align: center;
    }
    
    .footer {
        padding: 1.5rem 1rem;
    }
    
    .footer-links {
        gap: 15px;
    }
}

@media (max-width: 576px) {
    .header-content {
        gap: 10px;
    }
    
    .logo-text h1 {
        font-size: 1.3rem;
    }
    
    .tagline {
        font-size: 0.9rem;
    }
    
    .page-title {
        font-size: 1.5rem;
    }
    
    .form-panel {
        padding: 15px;
    }
    
    .panel-header h2 {
        font-size: 1.3rem;
    }
    
    .form-input {
        padding: 12px;
    }
    
    .btn {
        padding: 14px;
        font-size: 14px;
    }
    
    .id-card-container {
        padding: 15px;
        min-height: 600px;
    }
    
    /* Scale ID card for small mobile */
    #id-card {
        transform: scale(0.5);
    }
    
    #id-card.portrait {
        transform: scale(0.5);
    }
    
    .preview-note {
        font-size: 0.8rem;
        padding: 10px;
    }
}

/* For very large screens, maintain full size */
@media (min-width: 1600px) {
    .main-container {
        max-width: 1500px;
    }
}

/* Print styles */
@media print {
    .form-panel,
    .header,
    .footer,
    .preview-header,
    .preview-note {
        display: none !important;
    }
    
    .main-container {
        margin: 0;
        padding: 0;
    }
    
    .container {
        display: block;
    }
    
    .id-card-container {
        box-shadow: none;
        border: none;
        padding: 0;
    }
    
    #id-card {
        transform: scale(1) !important;
    }
    
    #id-card.portrait {
        transform: scale(1) !important;
    }
}
</style>
</head>

<body>

<header class="header">
    <div class="header-content">
        <div class="logo">
            <div class="logo-icon">
                <i class="fas fa-id-card"></i>
            </div>
            <div class="logo-text">
                <h1>Villa Zaragoza</h1>
                <p>Exclusive Residential Village</p>
            </div>
        </div>
        <div class="tagline">
            Creating official identification for our valued residents
        </div>
    </div>
</header>

<div class="main-container">
    <h1 class="page-title">Official Resident ID Maker</h1>
    
    <div class="container">
        <div class="form-panel">
            <div class="panel-header">
                <div class="panel-icon">
                    <i class="fas fa-user-edit"></i>
                </div>
                <h2>Resident Information <small style="color: #e74c3c; font-size: 0.9rem;">(All fields required)</small></h2>
            </div>
            
            <!-- Validation Status -->
            <div id="validationStatus" class="validation-status error">
                Please fill in all required fields to continue
            </div>
            
            <!-- SWITCH -->
            <div class="form-group">
                <div class="switch-wrapper">
                    <span class="switch-label">Landscape</span>
                    <label class="switch">
                        <input type="checkbox" id="orientationSwitch" onchange="setOrientation()">
                        <span class="slider"></span>
                    </label>
                    <span class="switch-label">Portrait</span>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="lname">Last Name <span class="required">*</span></label>
                <input class="form-input" id="lname" placeholder="Enter last name" oninput="validateField(this)" onblur="validateField(this)">
                <div class="error-message" id="lname-error">Last name is required</div>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="fname">First Name <span class="required">*</span></label>
                <input class="form-input" id="fname" placeholder="Enter first name" oninput="validateField(this)" onblur="validateField(this)">
                <div class="error-message" id="fname-error">First name is required</div>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="mname">Middle Name <span class="required">*</span></label>
                <input class="form-input" id="mname" placeholder="Enter middle name" oninput="validateField(this)" onblur="validateField(this)">
                <div class="error-message" id="mname-error">Middle name is required</div>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="addressInput">Address <span class="required">*</span></label>
                <input class="form-input" id="addressInput" placeholder="House No., Street, Villa Zaragoza" oninput="validateField(this)" onblur="validateField(this)">
                <div class="error-message" id="addressInput-error">Address is required</div>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="contactInput">Contact Number <span class="required">*</span></label>
                <input class="form-input" id="contactInput" placeholder="09XXXXXXXXX" oninput="validateField(this)" onblur="validateField(this)">
                <div class="error-message" id="contactInput-error">Valid contact number is required (11 digits)</div>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="photoUpload">1x1 ID Photo <span class="required">*</span></label>
                <input class="form-input" type="file" id="photoUpload" accept="image/*" onchange="loadPhoto(event)">
                <div class="photo-preview" id="photoPreview">
                    <div class="photo-placeholder">
                        <i class="fas fa-user-circle"></i>
                        <p>No photo selected</p>
                    </div>
                </div>
                <div class="error-message" id="photoUpload-error">1x1 ID photo is required</div>
                <small style="display: block; margin-top: 5px; color: #666;">Please upload a recent 1x1 ID photo with white background</small>
            </div>
            
            <div class="button-group">
                <button class="btn btn-primary" id="updateBtn" onclick="updateID()" disabled>
                    <i class="fas fa-sync-alt"></i> Update ID Preview
                </button>
                <button class="btn btn-success" id="downloadPngBtn" onclick="downloadPNG()" disabled>
                    <i class="fas fa-download"></i> Download as PNG
                </button>
                <button class="btn btn-secondary" id="downloadJpgBtn" onclick="downloadJPG()" disabled>
                    <i class="fas fa-download"></i> Download as JPG
                </button>
                <button class="btn btn-warning" id="downloadPdfBtn" onclick="downloadPDF()" disabled>
                    <i class="fas fa-file-pdf"></i> Download as PDF
                </button>
            </div>
        </div>
        
        <div class="preview-panel">
            <div class="preview-header">
                <h2 class="preview-title">ID Card Preview</h2>
                <div class="preview-actions">
                    <span id="current-orientation" style="font-weight: 600; color: #0d3b66;">Landscape</span>
                </div>
            </div>
            
            <div class="preview-note">
                <i class="fas fa-info-circle"></i> Please complete all required fields above to preview and download your ID card.
            </div>
            
            <div class="id-card-container">
                <div id="id-card">
                    <div id="photo-box"><img id="photo"></div>
                    <div id="name" class="text">COMPLETE ALL FIELDS TO PREVIEW</div>
                    <div id="address" class="text">ADDRESS WILL APPEAR HERE</div>
                    <div id="contact" class="text">CONTACT NUMBER</div>
                </div>
            </div>
        </div>
    </div>
</div>

<footer class="footer">
    <div class="footer-content">
        <p>© 2023 Villa Zaragoza Residential Village. All rights reserved.</p>
        <p>This ID is the official property of Villa Zaragoza Village Association.</p>
        <div class="footer-links">
            <a href="#">Privacy Policy</a>
            <a href="#">Terms of Use</a>
            <a href="#">Contact Administration</a>
        </div>
    </div>
</footer>

<script>
// Track validation state
let isFormValid = false;
let hasPhoto = false;

// Function to validate individual field
function validateField(field) {
    const value = field.value.trim();
    const fieldId = field.id;
    const errorElement = document.getElementById(`${fieldId}-error`);
    
    // Special validation for contact number
    if (fieldId === 'contactInput') {
        const isValid = /^09\d{9}$/.test(value); // Must start with 09 and have 11 digits total
        if (!isValid) {
            field.classList.remove('valid');
            field.classList.add('error');
            errorElement.style.display = 'block';
            errorElement.textContent = value.length === 0 ? 'Contact number is required' : 'Please enter a valid 11-digit number starting with 09';
            return false;
        }
    } 
    // Validation for other fields
    else if (value.length === 0) {
        field.classList.remove('valid');
        field.classList.add('error');
        errorElement.style.display = 'block';
        return false;
    }
    
    // If field is valid
    field.classList.remove('error');
    field.classList.add('valid');
    errorElement.style.display = 'none';
    
    // Check photo separately
    checkPhotoUpload();
    
    // Validate entire form
    validateForm();
    return true;
}

// Function to check photo upload
function checkPhotoUpload() {
    const photoUpload = document.getElementById('photoUpload');
    const errorElement = document.getElementById('photoUpload-error');
    
    if (!photoUpload.files || photoUpload.files.length === 0) {
        errorElement.style.display = 'block';
        hasPhoto = false;
        return false;
    }
    
    errorElement.style.display = 'none';
    hasPhoto = true;
    return true;
}

// Function to validate entire form
function validateForm() {
    const fields = [
        'lname', 'fname', 'mname', 'addressInput', 'contactInput'
    ];
    
    let allValid = true;
    
    // Check all text fields
    for (const fieldId of fields) {
        const field = document.getElementById(fieldId);
        const value = field.value.trim();
        
        // Special validation for contact
        if (fieldId === 'contactInput') {
            if (!/^09\d{9}$/.test(value)) {
                allValid = false;
                break;
            }
        } else if (value.length === 0) {
            allValid = false;
            break;
        }
    }
    
    // Check photo
    if (!hasPhoto) {
        allValid = false;
    }
    
    // Update form validation state
    isFormValid = allValid;
    
    // Update validation status message
    const validationStatus = document.getElementById('validationStatus');
    if (allValid) {
        validationStatus.textContent = 'All fields are complete. You can now preview and download your ID.';
        validationStatus.className = 'validation-status success';
        validationStatus.style.display = 'block';
        
        // Enable buttons
        document.getElementById('updateBtn').disabled = false;
        document.getElementById('downloadPngBtn').disabled = false;
        document.getElementById('downloadJpgBtn').disabled = false;
        document.getElementById('downloadPdfBtn').disabled = false;
    } else {
        validationStatus.textContent = 'Please fill in all required fields to continue';
        validationStatus.className = 'validation-status error';
        validationStatus.style.display = 'block';
        
        // Disable buttons
        document.getElementById('updateBtn').disabled = true;
        document.getElementById('downloadPngBtn').disabled = true;
        document.getElementById('downloadJpgBtn').disabled = true;
        document.getElementById('downloadPdfBtn').disabled = true;
    }
    
    return allValid;
}

// Function to generate a clean filename from the person's name
function getFileName() {
    const lname = document.getElementById("lname").value.trim();
    const fname = document.getElementById("fname").value.trim();
    const mname = document.getElementById("mname").value.trim();
    
    // Build name parts
    let nameParts = [];
    if (lname) nameParts.push(lname);
    if (fname) nameParts.push(fname);
    if (mname) nameParts.push(mname.charAt(0)); // Use only initial of middle name
    
    // Join with underscores and remove any special characters
    let fileName = nameParts.join('_')
        .toUpperCase()
        .replace(/[^A-Z0-9_]/g, '') // Remove non-alphanumeric characters except underscore
        .replace(/\s+/g, '_') // Replace spaces with underscores
        .replace(/_+/g, '_'); // Replace multiple underscores with single
    
    return fileName;
}

function updateID(){
    // Validate form before updating
    if (!validateForm()) {
        alert('Please complete all required fields before updating the ID preview.');
        return;
    }
    
    document.getElementById("name").innerText =
        (lname.value + ", " + fname.value + " " + mname.value).toUpperCase();
    document.getElementById("address").innerText =
        addressInput.value.toUpperCase();
    document.getElementById("contact").innerText =
        contactInput.value;
}

function loadPhoto(e){
    const file = e.target.files[0];
    if (!file) return;
    
    let r = new FileReader();
    r.onload = function() {
        // Update main ID card photo
        document.getElementById('photo').src = r.result;
        
        // Update preview thumbnail
        const preview = document.getElementById('photoPreview');
        preview.innerHTML = `<img src="${r.result}" alt="Photo Preview">`;
        
        // Validate photo
        checkPhotoUpload();
        validateForm();
    };
    r.readAsDataURL(file);
}

function setOrientation(){
    const card = document.getElementById("id-card");
    const sw = document.getElementById("orientationSwitch");
    const orientationLabel = document.getElementById("current-orientation");
    
    if(sw.checked) {
        card.classList.add("portrait");
        orientationLabel.textContent = "Portrait";
    } else {
        card.classList.remove("portrait");
        orientationLabel.textContent = "Landscape";
    }
}

function downloadPNG(){
    // Validate form before downloading
    if (!validateForm()) {
        alert('Please complete all required fields before downloading.');
        return;
    }
    
    const fileName = getFileName() + "_ID.png";
    
    html2canvas(document.getElementById("id-card"), { 
        scale: 2,
        useCORS: true,
        backgroundColor: null
    }).then(canvas => {
        const link = document.createElement("a");
        link.download = fileName;
        link.href = canvas.toDataURL("image/png");
        link.click();
    });
}

function downloadJPG(){
    // Validate form before downloading
    if (!validateForm()) {
        alert('Please complete all required fields before downloading.');
        return;
    }
    
    const fileName = getFileName() + "_ID.jpg";
    
    html2canvas(document.getElementById("id-card"), { 
        scale: 2,
        useCORS: true,
        backgroundColor: null
    }).then(canvas => {
        const link = document.createElement("a");
        link.download = fileName;
        link.href = canvas.toDataURL("image/jpeg", 1.0);
        link.click();
    });
}

function downloadPDF(){
    // Validate form before downloading
    if (!validateForm()) {
        alert('Please complete all required fields before downloading.');
        return;
    }
    
    const fileName = getFileName() + "_ID.pdf";
    
    html2canvas(document.getElementById("id-card"), { 
        scale: 2,
        useCORS: true,
        backgroundColor: null
    }).then(canvas => {
        const img = canvas.toDataURL("image/png");
        const { jsPDF } = window.jspdf;
        const isPortrait = document.getElementById("orientationSwitch").checked;

        let pdf;
        if(isPortrait){
            pdf = new jsPDF("portrait", "px", [638, 1012]);
            pdf.addImage(img, "PNG", 0, 0, 638, 1012);
        } else {
            pdf = new jsPDF("landscape", "px", [1012, 638]);
            pdf.addImage(img, "PNG", 0, 0, 1012, 638);
        }

        pdf.save(fileName);
    });
}

// Initialize form validation on page load
window.onload = function() {
    // Initial validation check
    validateForm();
    
    // Add input event listeners to all required fields
    const requiredFields = ['lname', 'fname', 'mname', 'addressInput', 'contactInput'];
    requiredFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        field.addEventListener('input', () => validateField(field));
        field.addEventListener('blur', () => validateField(field));
    });
    
    // Add change event listener for photo upload
    document.getElementById('photoUpload').addEventListener('change', checkPhotoUpload);
};
</script>

</body>
</html>